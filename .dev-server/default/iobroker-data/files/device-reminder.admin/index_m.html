<html>

<head>

    <!-- Load ioBroker scripts and styles-->
    <link rel="stylesheet" type="text/css" href="../../css/adapter.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/fancytree/ui.fancytree.min.css" />
    <link type="text/css" rel="stylesheet" href="../../lib/css/themes/jquery-ui/default/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/css/iob/selectID.css" />

    <script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui-1.10.3.full.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery.fancytree-all.min.js"></script>
    <script type="text/javascript" src="../../lib/js/materialize.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../js/translate.js"></script>
    <script type="text/javascript" src="../../js/adapter-settings.js"></script>
    <script type="text/javascript" src="words.js"></script>

    <!-- Load our own files -->
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="./lib/dataSendTo.js"></script>

    <script type="text/javascript">

        // let dataSendTo = {};

        // dataSendTo.telegram = {
        //     name: 'telegram',
        //     obj: { dataChecked: [], dataFailed: [] },
        //     objType: { cmd: 'telegram' }
        // };
        // dataSendTo.devices = {
        //     name: 'devices',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-devices`, header: 'header-device', name: `devices`, anchorEn: `create-device`, anchorGer: `device-anlegen`, anchorName: `device` },
        //     objType: { cmd: 'val', 1: 'name', 2: 'consumption', 3: 'switch', cntr: 3 }
        // }
        // dataSendTo.alexa = {
        //     name: 'alexa',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-alexa`, header: 'header-alexa', name: `alexa`, anchorEn: `create-alexa`, anchorGer: `alexa-erstellen`, anchorName: `alexa` },
        //     objType: { cmd: 'val', 1: 'name', 2: 'path', cntr: 2 }
        // };
        // dataSendTo.sayit = {
        //     name: 'sayit',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-sayit`, header: 'header-sayit', name: `sayit`, anchorEn: `create-sayit-device`, anchorGer: `sayit-device-erstellen`, anchorName: `sayit` },
        //     objType: { cmd: 'val', 1: 'name', 2: 'path', cntr: 2 }
        // };
        // dataSendTo.whatsapp = {
        //     name: 'whatsapp',
        //     obj: { dataChecked: [], dataFailed: [], err: `errWhatsapp`, header: 'header-whatsapp', name: `whatsapp`, anchorEn: `create-whatsapp-user`, anchorGer: `whatsapp-user-erstellen`, anchorName: `whatsapp` },
        //     objType: { cmd: 'val', 1: 'name', 2: 'path', cntr: 2 }
        // };
        // dataSendTo.pushover = {
        //     name: 'pushover',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-pushover`, header: 'header-pushover', name: `pushover`, anchorEn: `create-pushover-user`, anchorGer: `pushover-user-erstellen`, anchorName: `pushover` },
        //     objType: { cmd: 'type', 1: 'name', 2: 'inst', 3: 'prio', 4: 'sound', cntr: 4 }
        // };
        // dataSendTo.email = {
        //     name: 'email',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-email`, header: 'header-email', name: `email`, anchorEn: `create-email-user`, anchorGer: `email-user-erstellen`, anchorName: `email` },
        //     objType: { cmd: 'email', 1: 'name', 2: 'emailFrom', 3: 'emailTo', cntr: 3 }
        // };
        // dataSendTo.default = {
        //     name: 'default',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-default`, header: 'header-default', name: `default type config`, anchorEn: `default-devices`, anchorGer: `default-devices`, anchorName: `default-type` },
        //     objType: { cmd: 'type', 1: 'name', 2: 'startVal', 3: 'endVal', 4: 'startCount', 5: 'endCount', cntr: 5 }
        // };
        // dataSendTo.custom = {
        //     name: 'custom',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-custom`, header: 'header-custom', name: `custom type config`, anchorEn: `custom-devices`, anchorGer: `custom-devices`, anchorName: `create-custom-type` },
        //     objType: { cmd: 'type', 1: 'name', 2: 'startVal', 3: 'endVal', 4: 'startCount', 5: 'endCount', cntr: 5 }
        // };
        // dataSendTo.status = {
        //     name: 'status',
        //     obj: { dataChecked: [], dataFailed: [], err: `err-status`, header: 'header-status', name: `device status`, anchorEn: `custom-states`, anchorGer: `eigene-zustaende`, anchorName: `custom-status` }
        // };

        let showSaveBtn;

        let headerOpened = ``;

        let device = [];

        let deviceTypes = [];

        let checkedUserInput = {};  // alle geprueften User Inputs werden hier gespeichert
        let dataGlobal = {};        // alle native Daten aus "settings" werden hier gespeichert

        function loadUser(settings, onChange) {

            $('.value').each(function () {
                const $key = $(this);
                const id = $key.attr('id');
                if ($key.attr('type') === 'checkbox') {
                    // do not call onChange direct, because onChange could expect some arguments
                    $key.prop('checked', settings[id])
                        .on('change', () => onChange(), $('.btn-save, .btn-save-close').fadeIn());
                    ;
                }
                else {
                    // do not call onChange direct, because onChange could expect some arguments
                    $key.val(settings[id])
                        .on('change', () => onChange(), $('.btn-save, .btn-save-close').fadeIn())
                        .on('keyup', () => onChange(), $('.btn-save, .btn-save-close').fadeIn())
                        ;
                };
            });
        };

        // This will be called by the admin adapter when the settings page loads
        async function load(settings, onChange) {

            $('.btn-save, .btn-save-close').css("display", "none");
            if (settings.devices === undefined || settings.devices.length <= 0) {
                $('.dynamic-table-devices').css("display", "none");
            };

            if (!settings) return;
            let namespace = `${adapter}.${instance}`;
            // instance alive?
            socket.emit('getState', `system.adapter.${namespace}.alive`, async (err, state) => {
                try {
                    const active = (state && state.val);
                    if (!active) {
                        $(`#test`).html(`<div class="collapsible-header red lighten-1"><i class="large material-icons">error_outline</i>Please activate the device-reminder.${instance} instance!</div>`);
                    } else {
                        showSaveBtn = onChange;

                        createGUI(settings);

                        $('.collapsible').collapsible();
                        $('.modal').modal();

                        async function createGUI(settings) {

                            dataGlobal = await createData(settings);
                            const resChecked = await staticTable(dataGlobal);
                            await dynamicTable(dataGlobal, resChecked);
                            $('.red').on('click', clickEventDelBtn); // click event auf delete button setzen
                            onChange(false);

                            function createData(settings) {

                                let data = {};
                                data.devices = {
                                    name: 'devices',
                                    idHTML: 'deviceID',
                                    ids: settings.devices !== undefined ? settings.devices.id || [] : [],
                                    idsTable: settings.devices !== undefined ? settings.devices.final || [] : [],
                                    cntr: settings.devices_counter !== undefined ? settings.devices_counter || 0 : 0,
                                };
                                data.alexa = {
                                    name: 'alexa',
                                    idHTML: 'alexaID',
                                    ids: settings.alexa !== undefined ? settings.alexa.id || [] : [],
                                    cntr: settings.alexa_counter !== undefined ? settings.alexa_counter || 0 : 0,
                                };
                                data.sayit = {
                                    name: 'sayit',
                                    idHTML: 'sayitID',
                                    ids: settings.sayit !== undefined ? settings.sayit.id || [] : [],
                                    cntr: settings.sayit_counter !== undefined ? settings.sayit_counter || 0 : 0,
                                };
                                data.whatsapp = {
                                    name: 'whatsapp',
                                    idHTML: 'whatsappID',
                                    ids: settings.whatsapp !== undefined ? settings.whatsapp.id || [] : [],
                                    cntr: 0, // wird automatisiert ausgelesen
                                };
                                data.telegram = {
                                    name: 'telegram',
                                    idHTML: '',
                                    ids: settings.telegram !== undefined ? settings.telegram.id || [] : [],
                                    cntr: 0, // wird automatisiert ausgelesen
                                };
                                data.pushover = {
                                    name: 'pushover',
                                    idHTML: 'pushoverID',
                                    ids: settings.pushover !== undefined ? settings.pushover.id || [] : [],
                                    cntr: settings.pushover_counter !== undefined ? settings.pushover_counter || 0 : 0,
                                };
                                data.email = {
                                    name: 'email',
                                    idHTML: 'emailID',
                                    ids: settings.email !== undefined ? settings.email.id || [] : [],
                                    cntr: settings.email_counter !== undefined ? settings.email_counter || 0 : 0,
                                };
                                data.custom = {
                                    name: 'custom',
                                    idHTML: 'customTypeID',
                                    ids: settings.customType !== undefined ? settings.custom.id || [] : [],
                                    cntr: settings.custom_device_counter !== undefined ? settings.custom_counter || 0 : 0,
                                };
                                data.default = {
                                    name: 'default',
                                    idHTML: 'defaultTypeID',
                                    ids: settings.default.id !== undefined ? settings.default.id || [] : [],
                                    cntr: settings.default_counter !== undefined ? settings.default_counter || 0 : 0,
                                };

                                data.alert = {
                                    name: 'alert',
                                    idHTML: 'freqAlert',
                                    ids: settings.freqAlert !== undefined ? settings.freqAlert.id || [] : [],
                                    cntr: settings.alert_counter !== undefined ? settings.alert_counter || 0 : 0,
                                };
                                data.presence = {
                                    name: 'presence',
                                    idHTML: 'presence',
                                    ids: settings.presence !== undefined ? settings.presence.id || [] : [],
                                    cntr: settings.presence_counter !== undefined ? settings.presence_counter || 0 : 0,
                                };
                                data.status = {
                                    name: 'status',
                                    idHTML: 'valStates',
                                    ids: settings.status.id !== undefined ? settings.status.id || [] : [],
                                    cntr: settings.status_counter !== undefined ? settings.status_counter || 0 : 0,
                                };

                                return data;
                            };

                            // create table
                            async function staticTable(data) {
                                for (const i in data) {
                                    const name = data[i].name;
                                    if (name !== 'telegram') {
                                        // if (name !== 'telegram' && name !== 'whatsapp') {
                                        if (name !== 'devices') {
                                            values2table(data[i].idHTML, data[i].ids, onChange); // create table
                                        };

                                        // create click event "disable save button"
                                        const btnSave = `#btn-check-${name}`;
                                        $(btnSave).fadeOut(); // save buttons deaktivieren bis events auf "add button" erkannt
                                        $(btnSave).on('click', async () => {
                                            dataGlobal = await btnPressed(settings, i);
                                            $(btnSave).fadeOut();
                                        });

                                        // create click event "add button"
                                        const btnAdd = `#btn-add-${name}`;
                                        $(btnAdd).on('click', async () => {
                                            $(btnSave).fadeIn();
                                            $(`#err-${name}`).html(`<div style="display: flex; align-items: center; color: red;">
                                                <span style="font-weight:bold;">${_("Pls check input")}</span></div>`);
                                            $('.btn-save, .btn-save-close').fadeOut();
                                            onChange(false);
                                        });

                                        // create event "change" on table
                                        const eventID = `#${data[i].idHTML}`;
                                        if (eventID !== '#valStates') {
                                            $(eventID).on('change keyup', () => {
                                                $(`#btn-check-${name}`).fadeIn();
                                                $(`#err-${name}`).html(`<div style="display: flex; align-items: center; color: red;">
                                                    <span style="font-weight:bold;">${_("Pls check input")}</span></div>`);
                                                $('.btn-save, .btn-save-close').fadeOut();
                                                onChange(false);
                                            });
                                        } else {
                                            $('#valStates').find('.values-input').on('change', () => {
                                                $('.btn-save, .btn-save-close').fadeIn();
                                                onChange(true);
                                            });
                                        };
                                    };
                                };

                                // trigger im "default table" setzen
                                // default hat keinen "add button" 
                                $('#defaultTypeID').find('.values-input').on('change', () => { // default hat keinen "add button"
                                    $('#btn-check-default').removeClass('disabled');
                                });

                                const checked = await checkInput(data, 'all');
                                checkedUserInput = checked;

                                values2table(data.devices.idHTML, data.devices.ids, onChange); // create table "devices", warten auf "types"
                                $('#disableFirstField').find('td:first-child .values-input').prop('disabled', true); // disable "name" in table default-types

                                return checked
                            };

                            async function dynamicTable(data, checked) {
                                dataGlobal = await createDynamicTable(data, onChange, checked); // create dynamic table "device"
                                if (M) M.updateTextFields();
                                // onChange(false);
                            };

                            async function btnPressed(settings, name) {
                                const actData = await createData(settings)
                                const data = await createSettings(actData);
                                // dataGlobal = await createSettings(actData);
                                const result = await checkInput(actData, name);
                                checkedUserInput[actData[name].name] = result[name];
                                dynamicTable(actData, checkedUserInput);

                                $('.red').on('click', clickEventDelBtn); // click event auf delete button setzen

                                if (checkedUserInput.devices !== undefined && checkedUserInput.devices.length >= 1) {
                                    $('.dynamic-table-devices').fadeIn();
                                    $('.btn-save, .btn-save-close').fadeIn();
                                };

                                onChange(true);

                                return data;
                            };

                            // create click event "delete device (delete button)"
                            async function clickEventDelBtn() {
                                if (headerOpened !== ``) { // Abfrage welcher button geklickt wurde
                                    clearTimeout;
                                    setTimeout(async () => {
                                        dataGlobal = await btnPressed(settings, headerOpened)
                                        onChange(true);
                                        if (dataGlobal.devices !== undefined && dataGlobal.devices.ids.length >= 1) {
                                            $('.dynamic-table-devices').fadeIn();
                                            $('.btn-save, .btn-save-close').fadeIn();
                                        } else {
                                            $('.dynamic-table-devices').fadeOut();
                                        };
                                    }, 100);
                                };
                            };

                        };
                    };
                } catch (e) {
                    console.error(e)
                };
            });
        };

        //##################################################################################################
        //############################################ Load End ############################################
        //##################################################################################################

        //##################################################################################################
        //############################################ save start ##########################################
        //##################################################################################################

        async function save(callback) {

            const actData = await createSettings(dataGlobal, 'save'); // aktuelle settings holen

            const cntr = await saveCntr(actData);   // counter fuer save obj erstellen

            const result = await loopArr(cntr) // devices, messenger, etc "final" erstellen

            let resultTemp = result

            const finalObj = resultTemp; // fertiges objekt fuer native settings

            async function saveCntr(actData) {
                // counter in die native schreiben
                let objTemp = actData;
                for (const name in actData) {
                    const cntrName = `${name}_counter`
                    objTemp[cntrName] = actData[name].cntr;
                };
                return objTemp;
            };

            async function loopArr(objCntr) {
                let objTemp = objCntr;
                for (const i in dataGlobal) {
                    const id = dataGlobal[i].name;
                    objTemp[id] = {
                        id: dataGlobal[i].ids,
                        final: await createArray(dataGlobal[i]),
                    };
                };
                return objTemp;
            };

            function createArray(obj) {

                const name = obj.name;

                let objTemp = {};
                for (const i in obj.ids) {
                    if (i !== undefined) {
                        const data = obj.ids[i];
                        if (name === 'devices') {
                            const dataTable = obj.idsTable[i]; // devices hat zwei daten arrays

                            // prüfen ob data in dataTable vorhanden ist
                            // und finales 'device' objekt erstellen
                            if (data.id == dataTable.id) {
                                objTemp[data.id] = {
                                    name: data.name,
                                    type: data.type,
                                    pathConsumption: data.consumption,
                                    pathSwitch: data.switch,
                                    startText: data.startText,
                                    endText: data.endText,
                                    runtimeMax: data.runtimeMax,
                                    enabled: dataTable.enabled,

                                    alexa: dataTable.alexa,
                                    sayit: dataTable.sayit,
                                    whatsapp: dataTable.whatsapp,
                                    telegram: dataTable.telegram,
                                    pushover: dataTable.pushover,
                                    email: dataTable.email,
                                    timer: dataTable.timer,

                                    autoOff: dataTable.autoOff,
                                    abort: dataTable.abort,
                                    id: dataTable.id
                                };
                            };
                        };

                        if (name === "alexa" || name === "sayit") {
                            timeMin = "";
                            timeMax = "";
                            let timeMinHourTemp = ``;
                            let timeMinMinTemp = ``;
                            let timeMaxHourTemp = ``;
                            let timeMaxMinTemp = ``;
                            if (data.timeMinHour !== `` && data.timeMinMin !== `` && data.timeMaxHour !== `` && data.timeMaxMin !== ``) {
                                timeMinHourTemp = data.timeMinHour;
                                timeMinMinTemp = data.timeMinMin;
                                timeMaxHourTemp = data.timeMaxHour;
                                timeMaxMinTemp = data.timeMaxMin;
                                timeMin = `${timeMinHourTemp}:${timeMinMinTemp}`;
                                timeMax = `${timeMaxHourTemp}:${timeMaxMinTemp}`;
                            };
                            if (data.volume < 0 || data.volume > 100 || data.volume === undefined || data.volume === '') {
                                data.volume = 50;
                            };
                        };

                        switch (name) {
                            case "alexa": {
                                objTemp[data.id] = {
                                    name: data.name,
                                    path: data.path,
                                    volume: data.volume,
                                    timeMin: timeMin,
                                    timeMax: timeMax
                                };
                                break;
                            };
                            case "sayit": {
                                objTemp[data.id] = {
                                    name: data.name,
                                    path: data.path,
                                    timeMin: timeMin,
                                    timeMax: timeMax,
                                    volume: data.volume
                                };
                                break;
                            };
                            case "whatsapp": {
                                objTemp[data.id] = {
                                    name: data.name,
                                    path: `whatsapp-cmb${data.inst}.sendMessage`,
                                };
                                break;
                            };
                            case "typeID": {
                                objTemp[data.id] = {
                                    name: data.name,
                                    startVal: data.startVal,
                                    endVal: data.endVal,
                                    startCount: data.startCount,
                                    endCount: data.endCount
                                };
                                break;
                            };
                            case "telegram": {
                                objTemp[data.id] = {
                                    name: data.nameFinal,
                                    inst: data.inst
                                };
                                break;
                            };
                            case "pushover": {
                                objTemp[data.id] = {
                                    name: data.name,
                                    inst: data.inst,
                                    prio: data.prio,
                                    sound: data.sound,
                                };
                                if (objTemp[data.id].prio == 'high') {
                                    objTemp[data.id].prio = 1;
                                } else if (objTemp[data.id].prio == 'quiet') {
                                    objTemp[data.id].prio = -1;
                                } else {
                                    delete objTemp[data.id].prio;
                                };
                                break;
                            };
                            case "email": {
                                objTemp[data.id] = {
                                    name: data.name,
                                    emailFrom: data.emailFrom,
                                    emailTo: data.emailTo
                                };
                                break;
                            };
                        };
                    };
                };
                return objTemp;
            };
            callback(finalObj); // daten in native settings schreiben
        };

        async function checkInput(data, type) {

            const result = await loop(type);
            return result;

            // user input überprüfen und auf callback warten
            function deviceCheck(dataSendTo, data, successCallback, errorCallback) {

                const name = dataSendTo.name
                // const id = dataSendTo.id
                const objType = dataSendTo.objType
                let obj = dataSendTo.obj;
                let arr;

                if (name != 'telegram' && name != 'whatsapp') {   // telegram / whatsapp uebergibt nur einen counter
                    arr = data.ids;
                } else {
                    arr = data;
                };

                try {
                    sendTo(null, objType, arr, async result => {
                        const res = await result;
                        if (res != undefined) {
                            obj.dataChecked = res.checked || [];
                            obj.dataFailed = res.failed || [];
                            if (name === 'default' || name === 'custom') { // device types erstellen
                                $.each(res.checked, async (index, element) => {
                                    deviceTypes.push(`${element.name}`);
                                });
                                $('#deviceTypeID').attr("data-options", deviceTypes.join(';'));
                            };
                            if (name !== 'telegram') { // telegram / whatsapp hat kein Auswahlfeld 
                                // if (name !== 'telegram' && name !== 'whatsapp') { // telegram / whatsapp hat kein Auswahlfeld 
                                checked(obj);   // Auswahlfelder erstellen
                            };
                            showHeader('dynamicTable', name, res.checked); // erkannte Geraete in "dynamicTable" einblenden
                            successCallback(res.checked);
                        };
                    });
                } catch (error) {
                    errorCallback(error);
                };
            };

            // promise erstellen
            function functionWrapper(dataSendTo, data) {
                return new Promise((resolve, reject) => {
                    deviceCheck(dataSendTo, data, (successResponse) => {
                        resolve(successResponse);
                    }, (errorResponse) => {
                        reject(errorResponse);
                    });
                });
            };

            async function functionLogic(dataSendTo, data) {
                try {
                    const result = await functionWrapper(dataSendTo, data);
                    return result;
                } catch (error) {
                    console.error("ERROR:" + error);
                };
            };

            async function loop(type) {

                try {
                    let result = {};
                    let checkData = {};
                    if (type !== 'all') {
                        checkData[type] = dataSendTo[type];
                    } else {
                        checkData = dataSendTo;
                    };

                    for (const i in checkData) { // check aller inputs 
                        const name = checkData[i].name
                        let obj = checkData[i].obj;
                        let arr = data[i].ids;
                        if (name == 'status') { // status wird nicht geprüft, da jede Eingabe erlaubt ist [string]
                            checked(checkData[name].obj)
                            $('#err-status').css('display', 'none');
                        } else {
                            result[name] = [];
                            if (name == 'telegram' || name == 'whatsapp') {
                                result[name] = await functionLogic(checkData[i], 0); // daten in der main.js prüfen und return
                            } else {
                                result[name] = await functionLogic(checkData[i], data[i]); // daten in der main.js prüfen und return
                            }
                        };
                    };
                    return result
                } catch (error) {
                    console.error(error);
                };
            };

            async function checked(obj) {
                if (obj.name !== `'device status'` && (obj.dataChecked.length <= 0) && (obj.dataFailed.length <= 0)) {
                    $(`#${obj.err}`).html(`<div style="display: flex; style="width: 40%; align-items: center; color: grey;">
                            <i class="material-icons">check_circle_outline</i><span>${_("no entries found")}</span> </div>`);
                    // Header innen "config devices"
                    $(`#${obj.header}`).html(`<div class="collapsible-header tabs translate"><i class="material-icons">create</i><span>${_(obj.name)}</span></div>`);
                    showSaveBtn(true); // save button einblenden
                } else if (obj.dataFailed.length >= 1) {
                    $(`#${obj.err}`).html(`<div style="display: flex; align-items: center; color: red;">
                            <i class="large material-icons">error_outline</i><span><b>${_("invalid input detected")}:</b><br> - ${obj.dataFailed.join('<br> - ')}</span></div>`);
                    // Header innen "config devices"
                    const text = `${obj.dataFailed.length} error(s) found in `
                    $(`#${obj.header}`).html(`<div class="collapsible-header red lighten-2 translate"><i class="material-icons">create</i><span>${_("Error(s) found in %s", obj.name)}</span></div>`);
                    // Header außen "config devices"
                    $(`#header-config`).html(`<div class="collapsible-header red lighten-2 translate"><i class="material-icons">create</i><span>${_("Error(s) found in configuration")}</span></div>`);
                    $('.btn-save, .btn-save-close').fadeOut();
                } else {
                    $(`#${obj.err}`).html(`<div style="display: flex; align-items: center; color: green;">
                            <i class="material-icons">check_circle_outline</i><span class="translate" style="font-weight:bold;">${_("Input checked")}</span></div>`);
                    // Header innen "config devices"
                    $(`#${obj.header}`).html(`<div class="collapsible-header tabs"><i class="material-icons">create</i><span>${_(obj.name)}</span></div>`);
                };
                $(`#help-${obj.anchorName}`).html(`<div><h4>create ${obj.name}</h4><p><a href="https://github.com/Xenon-s/ioBroker.device-reminder/blob/master/README.md#${obj.anchorEn}" target="_blank">${obj.anchorEn} english</a></p>
                    <p><a href="https://github.com/Xenon-s/ioBroker.device-reminder/blob/master/README_GER.md#${obj.anchorGer}" target="_blank">${obj.anchorGer} deutsch</a></p></div>`);
            };
        };

        async function createDynamicTable(settings, onChange, checked) {

            let curDevice = null;
            const settingsDevice = settings.devices.ids;
            const settingsTable = settings.devices.idsTable;
            const devices = checked.devices;

            $('#dynamic-table-body').html("");

            for (const i in devices) {
                curDevice = null;

                let data = [];
                const ID = devices[i].name;
                let deviceId = devices[i].id;

                const resultCurDevice = await createCurDevice();

                if (resultCurDevice == null || resultCurDevice == undefined) {
                    curDevice = {
                        enabled: true, name: devices[i].name, alexa: -1, sayit: -1, whatsapp: -1, telegram: -1, pushover: -1, email: -1, autoOff: false, timer: 0, abort: false, id: -1
                    };
                } else {
                    curDevice = resultCurDevice;
                };

                async function createCurDevice() {
                    let objTemp = null;
                    for (const j in settingsTable) {
                        if (settingsTable[j].deviceName == ID || settingsTable[j].name == ID) { // in Version 1.1 hat sich der ".deviceName" in ".name" geaendert!
                            objTemp = settingsTable[j];
                        };
                    };
                    return objTemp;
                };

                // data fuer dynamic table erstellen
                data = [
                    { type: 'checkbox', name: "enabled", value: curDevice.enabled },
                    { type: 'label', name: "name", value: curDevice.name },
                    { type: 'multiple', data: checked.alexa, name: "alexa", value: curDevice.alexa },
                    { type: 'multiple', data: checked.sayit, name: "sayit", value: curDevice.sayit },
                    { type: 'multiple', data: checked.telegram, name: "telegram", value: curDevice.telegram },
                    { type: 'multiple', data: checked.whatsapp, name: "whatsapp", value: curDevice.whatsapp },
                    { type: 'multiple', data: checked.pushover, name: "pushover", value: curDevice.pushover },
                    { type: 'multiple', data: checked.email, name: "email", value: curDevice.email },
                    { type: 'checkbox', name: "autoOff", value: curDevice.autoOff },
                    { type: 'timer', name: "timer", value: parseInt(curDevice.timer) },
                    { type: 'checkbox', name: "abort", value: curDevice.abort },
                    { type: 'id', name: "id", value: parseInt(deviceId) }
                ];

                let col = "<tr>";
                for (const j in data) {
                    if (data[j].data == undefined || data[j].data.length > 0) {
                        let style = 'style="text-align:center;"';
                        if (data[j].name == "name") {
                            style = 'style="font-weight:bold; text-align:center;"';
                        };
                        col += `<td data-type=${data[j].type} data-name="${data[j].name}" ${style}>`;
                        switch (data[j].type) {
                            case 'checkbox':
                                let checked = '';
                                if (data[j].value == true || data[j].value == 'on') {
                                    checked = 'checked="checked"';
                                }
                                col += `<label><input type="checkbox" class="values-input" ${checked} data-old-value="${data[j].value}"><span></span></label>`;
                                break;
                            case 'label':
                                col += `<span class="values-input" data-old-value="${data[j].value}">${data[j].value}</span>`;
                                break;
                            case 'multiple':
                                if (data[j].data != undefined && data[j].data.length > 0) {
                                    col += `<select multiple class="values-input" data-old-value="${data[j].value}">`;
                                    data[j].data.forEach(name => {
                                        let checked = '';
                                        if ($.inArray(name, data[j].value))
                                            checked = 'selected';
                                        col += `<option ${checked} value='${name.id}'>${name.name}</option>`
                                    });
                                    col += `</select>`;
                                };
                                break;
                            case 'timer':
                                col += `<input type="number" min="0" class="values-input" data-old-value="${data[j].value}" style="text-align:center">`;
                                break;
                            case 'id':
                                col += `<span class="values-input" data-old-value="${data[j].value}">${data[j].value}</span>`;
                                break;
                            default:
                                col += `Test`;
                                break;
                        };
                        col += `</td>`;
                    };
                };

                col += "</tr>";
                $('#dynamic-table-body').append(col);

                // vom User gesetzte "multiple options" in der Tabelle anzeigen
                $('#dynamic-table-body').children().eq(i).children().each(function () {
                    if ($(this).data('type') == 'multiple') {
                        $(this).find('select').val(curDevice[$(this).data('name')]);
                    }
                    else {
                        $(this).find('input').val(curDevice[$(this).data('name')]);
                    };
                });

                // trigger im dynamic table setzen
                $('#dynamic-table-body').find('.values-input').on('change', function () {
                    $('.btn-save, .btn-save-close').fadeIn();
                    onChange(true);
                });
            };

            if (curDevice != null) {
                const selectInstance = M.FormSelect.getInstance($('select'));
                instances = M.FormSelect.init($('select'));
                M.updateTextFields();
            };

            return settings;
        };

        async function createSettings(data, type) {

            let obj = {};
            obj = data;

            // Daten aus tabellen nur holen, wenn neues device erzeugt wurde
            if (type !== 'save') {

                const result = await getDataFromTable(); // daten für jedes device holen

                for (const name in result) { // jedes device aus der tabelle aktualieren und ID vergeben
                    obj[name].ids = await createId(result[name], data[name].cntr, `${name}_counter`, name);
                };

                async function getDataFromTable() { // daten aus tabellen holen
                    let objTemp = {};
                    for (const i in data) {
                        const name = data[i].name;
                        const idHTML = data[i].idHTML;
                        let result = {};
                        if (name !== 'telegram') {
                            // if (name !== 'telegram' && name !== 'whatsapp') {
                            result = await table2values(idHTML);
                        } else {
                            // if (name === 'telegram' || name === 'whatsapp') {
                            if (name === 'telegram') {
                                result = checkedUserInput[name];
                            };
                        };
                        objTemp[name] = result
                    };
                    return objTemp;
                };

                function createId(array, counter, counter_name, name) { // jedem device eine ID zuweisen
                    for (const i in array) {
                        if (array[i].id == "") {
                            array[i].id = counter;
                            counter++;
                        };
                    };
                    obj[name].cntr = counter;
                    return array;
                };
            };

            let body = $('#dynamic-table-body');
            let geraete = [];

            body.children().each(function () {  // daten aus dyn. tabelle sichern
                let data = {};
                $(this).children().each(function () {
                    let value;
                    if ($(this).data('type') == 'multiple') {
                        value = $(this).find('select').val();
                        $(this).find('select').data('old-value', value);
                    } else if ($(this).data('type') == 'label') {
                        value = $(this).find('span').text();
                    } else if ($(this).data('type') == 'checkbox') {
                        value = $(this).find('input').prop('checked');
                        $(this).find('input').data('old-value', value);
                    } else if ($(this).data('type') == 'id') {
                        value = $(this).find('span').text();
                    } else {
                        value = $(this).find('input').val();
                        $(this).find('input').data('old-value', value);
                    };
                    data[$(this).data('name')] = value;
                });
                geraete.push(data); // device daten in array pushen
            });
            obj.devices.idsTable = geraete; // dynamische daten in devices sichern
            return obj; // settings zurueckgeben
        };

        function showHeader(tblId, columnName, arr) {
            if (columnName !== undefined) {
                if (arr.length > 0 && columnName !== undefined) {
                    $('#' + tblId + ' [data-name="' + columnName + '"]').css('display', 'table-cell');
                }
                else {
                    $('#' + tblId + ' [data-name="' + columnName + '"]').css('display', 'none');
                };
            };
        };

        function selectedHeader(str) {
            if (headerOpened === ``) {
                headerOpened = str;
            } else {
                headerOpened = headerOpened === str ? `` : str;
            };
        };

    </script>
</head>

<body>

    <div class="m adapter-container">
        <div id="header-area" class="row">
            <div id="header-logo-title" class="col s6">
                <img class="logo" src="icon.png">
                <p>
                    <span class="translate h-title" data-lang="device-reminder"></span><br />
                    <span class="translate h-sub-title" data-lang="Monitoring of devices based on consumption"></span>
                </p>
            </div>
        </div>

        <div class="row" id="test">
            <div class="col s12" id="tab-area">
                <ul class="tabs blue lighten-4" width="4%">
                    <li class="tab col s6 l4"><a href="#tab-config" class="translate active" data-lang="Configuration"></a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="dynamic-table-devices">
                <div id="header-link-device">
                    <!-- text -->
                </div>
                <div id="device">

                    <div class="row">
                        <table id="dynamicTable" class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th class="header translate" style="width: 5%; background: #174475"
                                        data-name="enabled" style="width: 60px" data-lang="active"></th>
                                    <th class="header translate" style="width: 20%; background: #174475"
                                        data-name="name" data-lang="device">
                                        </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-name="alexa">
                                        alexa</th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-name="sayit">
                                        SayIt</th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-name="telegram">telegram</th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-name="whatsapp">whatsapp</th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-name="pushover">pushover</th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-name="email">
                                        email</th>
                                    <th class="header translate" style="width: 10%; background: #174475"
                                        data-name="autoOff" data-lang="switch off">
                                    </th>
                                    <th class="header translate" style="width: 10%; background: #174475"
                                        data-name="timer" data-lang="switch off after minutes"></th>
                                    <th class="header translate" style="width: 10%; background: #174475"
                                        data-name="abort" data-lang="abort detection">
                                    </th>
                                    <th class="header translate" data-name="id" style="width: 0px; display: none;">id
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="dynamic-table-body" class="table-values">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab with id "config" -->
        <div id="tab-config" class="col s12 page active">

            <!-- collapsible table -->

            <ul class="collapsible expandable">

                <!-- user devices -->
                <li>
                    <!-- create device -->
                    <div id="header-device" class="translat" onclick="selectedHeader('devices')">
                        <!-- text -->
                    </div>

                    <div class="collapsible-body" id="deviceID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-devices'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;" data-lang="add device"></span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-devices" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8 translate" id="err-devices">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal1">help</a>
                                <!-- Modal Structure -->
                                <div id="modal1" class="modal">
                                    <div id="help-device" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span class="translate" style="font-weight:bold;" data-lang="*Required fields"></span>
                        </div>
                        <table class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th data-name="_index" style="width: 5%; background: #174475"
                                        class="header translate"></th>
                                    <th data-name="name" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="device name">
                                    </th>
                                    <th id="deviceTypeID" style="width: 40%; background: #174475" data-name="type"
                                        data-type="select" style="width: 150px" class="header translate" data-options=""
                                        data-lang="device type">
                                    </th>
                                    <th data-name="consumption" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-lang="consumption">
                                    </th>
                                    <th data-name="switch" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-lang="Power switch">
                                    </th>
                                    <th data-name="startText" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-lang="starttext">
                                    </th>
                                    <th data-name="endText" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-lang="endtext">
                                    </th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th data-name="id" style="width: 0px; display: none;" class="header translate">
                                        id</th>
                                </tr>
                            </thead>
                        </table>
                        <!-- </div> -->
                    </div>
                </li>

                <!-- alexa devices -->
                <li>
                    <div id="header-alexa" class="translate" onclick="selectedHeader('alexa')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body" id="alexaID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-alexa'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;" data-lang="add alexa">add
                                        device</span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-alexa" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8" id="err-alexa">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal2">help</a>
                                <!-- Modal Structure -->
                                <div id="modal2" class="modal">
                                    <div id="help-alexa" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span class="translate" style="font-weight:bold;" data-lang="*Required fields"></span>
                        </div>
                        <table class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th data-name="_index" style="width: 5%; background: #174475"
                                        class="header translate"></th>
                                    <th data-name="name" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="name">
                                    </th>
                                    <th data-name="path" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-lang="'alexa2/../announcement'/'speak'">
                                    </th>
                                    <th data-name="volume" style="width: 10%; background: #174475;" data-type="number"
                                        class="header translate" data-lang="*volume 0-100" data-default="50"></th>
                                    <th data-name="timeMinHour" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="active from hour"
                                        data-default="0"
                                        data-options="0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;21;22;23">
                                    </th>
                                    <th data-name="timeMinMin" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="active from minute"
                                        data-default="00" data-options="00;15;30;45"></th>
                                    <th data-name="timeMaxHour" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="inactive from hour"
                                        data-default="23"
                                        data-options="0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;21;22;23">
                                    </th>
                                    <th data-name="timeMaxMin" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="inactive from minute"
                                        data-default="59" data-options="00;15;30;45;59"></th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th data-name="id" style="width: 0px; display: none;" class="header translate">
                                        id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- sayit -->

                <li>
                    <div id="header-sayit" class="translate" onclick="selectedHeader('sayit')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body " id="sayitID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-sayit'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;" data-lang="add sayit device">add
                                        device</span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-sayit" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8" id="err-sayit">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal3">help</a>
                                <!-- Modal Structure -->
                                <div id="modal3" class="modal">
                                    <div id="help-sayit" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <span class="translate" style="font-weight:bold;" data-lang="*Required fields"></span>
                        <table class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th data-name="_index" style="width: 5%; background: #174475"
                                        class="header translate"></th>
                                    <th data-name="name" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="*name">
                                    </th>
                                    <th data-name="path" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-default="sayit.0.tts.text"
                                        data-lang="*'sayit/../text'">
                                    </th>
                                    <th data-name="volume" style="width: 10%; background: #174475" data-type="number"
                                        class="header translate" data-lang="*volume 0-100" data-default="50"></th>
                                    <th data-name="timeMinHour" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="active from hour"
                                        data-default="0"
                                        data-options="0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;21;22;23">
                                    </th>
                                    <th data-name="timeMinMin" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="active from minute"
                                        data-default="00" data-options="00;15;30;45"></th>
                                    <th data-name="timeMaxHour" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="inactive from hour"
                                        data-default="23"
                                        data-options="0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;21;22;23">
                                    </th>
                                    <th data-name="timeMaxMin" style="width: 10%; background: #174475"
                                        data-type="select" class="header translate" data-lang="inactive from minute"
                                        data-default="59" data-options="00;15;30;45;59"></th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th data-name="id" style="width: 0px; display: none;" class="header translate">
                                        id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- whatsapp -->

                <li>
                    <div id="header-whatsapp" class="translate" onclick="selectedHeader('whatsapp')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body " id="whatsappID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-whatsapp'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;" data-lang="add whatsapp user">add
                                        device</span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-whatsapp" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8" id="err-whatsapp">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal4">help</a>
                                <!-- Modal Structure -->
                                <div id="modal4" class="modal">
                                    <div id="help-whatsapp" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <span class="translate" style="font-weight:bold;" data-lang="*Required fields"></span>
                        <table class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th data-name="_index" style="width: 5%; background: #174475"
                                        class="header translate"></th>
                                    <th data-name="name" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="*name">
                                    </th>
                                    <th data-name="path" style="width: 40%; background: #174475" data-type="OID"
                                        class="header translate" data-default="whatsapp-cmb.0.sendMessage"
                                        data-lang="*'whatsapp-cmb/../sendMessage'"></th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th data-name="id" style="width: 0px; display: none;" class="header translate">
                                        id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- pushover -->

                <li>
                    <div id="header-pushover" class="translate" onclick="selectedHeader('pushover')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body " id="pushoverID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-pushover'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;"
                                        data-lang="add pushover instance">add device</span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-pushover" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8" id="err-pushover">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal5">help</a>
                                <!-- Modal Structure -->
                                <div id="modal5" class="modal">
                                    <div id="help-pushover" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <span class="translate" style="font-weight:bold;" data-lang="*Required fields"></span>
                        <table class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th data-name="_index" style="width: 5%; background: #174475"
                                        class="header translate"></th>
                                    <th data-name="name" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="*name">
                                    </th>
                                    <th data-name="inst" style="width: 10%; background: #174475" data-type="number"
                                        class="header translate" data-lang="*pushover instance" data-default="0">
                                    </th>
                                    <th data-name="prio" style="width: 10%; background: #174475" data-type="select"
                                        class="header translate" data-lang="*priority" data-default="normal"
                                        data-options="normal;high;quiet"></th>
                                    <th data-name="sound" style="width: 10%; background: #174475" data-type="select"
                                        class="header translate" data-lang="*sound" data-default="pushover"
                                        data-options="pushover; bike; bugle; cashregister; classical; cosmic; falling; gamelan; incoming; intermission; magic; mechanical; pianobar; siren; spacealarm; tugboat; alien; climb; persistent; echo; updown; none">
                                    </th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th data-name="id" style="width: 0px; display: none;" class="header translate">
                                        id </th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- email -->

                <li>
                    <div id="header-email" class="translate" onclick="selectedHeader('email')">

                    </div>
                    <div class="collapsible-body " id="emailID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-email'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;" data-lang="add email">add
                                        device</span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-email" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8" id="err-email">
                                    <!-- text -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal6">help</a>
                                <!-- Modal Structure -->
                                <div id="modal6" class="modal">
                                    <div id="help-email" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <span class="translate" style="font-weight:bold;" data-lang="*Required fields"></span>
                        <table class="table-values changeOnChangeEvent remove-last-column">
                            <thead>
                                <tr>
                                    <th data-name="_index" style="width: 5%; background: #174475"
                                        class="header translate"></th>
                                    <th data-name="name" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="*name">
                                    </th>
                                    <th data-name="emailFrom" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="*sender address">
                                    </th>
                                    <th data-name="emailTo" style="width: 40%; background: #174475" data-type="text"
                                        class="header translate" data-lang="*receiver address">
                                    </th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th data-name="id" style="width: 0px; display: none;" class="header translate">
                                        id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- default devices -->

                <li>
                    <div id="header-default" class="translate" onclick="selectedHeader('default')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body " id="defaultTypeID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div>
                                    <a id="btn-check-default" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s10" id="err-default">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal7">help</a>
                                <!-- Modal Structure -->
                                <div id="modal7" class="modal">
                                    <div id="help-default-type" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <table id="disableFirstField" class="table-values remove-last-column">
                            <thead>
                                <tr>
                                    <th id="disableFirstField" style="width: 40%; background: #174475"
                                        class="header translate" data-type="text" data-name="name" data-lang="name">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="startVal" data-lang="threshold 'start' (watt)">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="endVal" data-lang="threshold 'end' (watt)">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="standby" data-lang="threshold 'standby' (watt)">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="startCount" data-lang="number of 'start' values">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="endCount" data-lang="number of ​'end' values">
                                    </th>
                                    <th class="header translate" data-type="number" data-name="id"
                                        style="width: 0px; display: none;">id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- custom devices -->

                <li>
                    <div id="header-custom" class="translate" onclick="selectedHeader('custom')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body " id="customTypeID">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col left s2">
                                    <a id='btn-add-custom'
                                        class="btn-floating waves-effect waves-light blue table-button-add">
                                        <i class="material-icons">add_circle_outline</i></a>
                                    <span class="translate" style="font-weight:bold;" data-lang="add device">add
                                        device</span>
                                </div>
                                <div class="col s2">
                                    <a id="btn-check-custom" class="waves-effect waves-light btn translate"
                                        data-lang="save"></a>
                                </div>
                                <div class="col s8" id="err-custom">
                                    <!-- 'text' -->
                                </div>
                                <!-- Modal Trigger -->
                                <a class="waves-effect waves-light btn modal-trigger translate" href="#modal8">help</a>
                                <!-- Modal Structure -->
                                <div id="modal8" class="modal">
                                    <div id="help-custom-type" class="modal-content translate">
                                        <div>
                                            <!-- text -->
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!"
                                                class="modal-close waves-effect waves-green btn-flat translate">close</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <table id="disableFirstField" class="table-values remove-last-column">
                            <thead>
                                <tr>
                                    <th id="disableFirstField" class="header translate"
                                        style="width: 40%; background: #174475" data-type="text" data-name="name"
                                        data-lang="name"></th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="startVal" data-lang="threshold 'start' (watt)">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="endVal" data-lang="threshold 'end' (watt)">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="standby" data-lang="threshold 'standby' (watt)">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="startCount" data-lang="number of 'start' values">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="number" data-name="endCount" data-lang="number of ​'end' values">
                                    </th>
                                    <th data-buttons="delete" style="width: 10%; background: #174475"
                                        class="header translate del-Btn" data-lang="delete"></th>
                                    <th class="header translate" data-type="number" data-name="id"
                                        style="width: 0px; display: none;">id</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- status -->

                <li>
                    <div id="header-status" class="translate" onclick="selectedHeader('status')">
                        <!-- text -->
                    </div>
                    <div class="collapsible-body " id="valStates">
                        <div class="row">
                            <div style="display: flex; align-items: center;">
                                <div class="col s8" id="err-status">
                                    <!-- 'text' -->
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5><span class="translate" data-lang="device status"></span></h5>
                        </div>
                        <table class="table-values changeOnChangeEvent remove-first-column" id="table-states">
                            <thead>
                                <tr>
                                    <th class="header translate" style="width: 0px; display: none;">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="text" data-name="stateAction" data-lang="status: 'in action'">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="text" data-name="stateStandby" data-lang="status: 'standby'">
                                    </th>
                                    <th class="header translate" style="width: 40%; background: #174475"
                                        data-type="text" data-name="stateOff" data-lang="status: 'device off'">
                                    </th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </li>

                <!-- collapsible end -->

            </ul>
        </div>

        <div class="m material-dialogs">
            <div id="dialog-select-member" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <div class="row">
                        <div class="col s12 title"></div>
                    </div>
                    <div class="row">
                        <div class="col s12 dialog-content"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="modal-action modal-close waves-effect waves-green btn btn-set"><i
                            class="large material-icons left">check</i><span class="translate">Select</span></a>
                    <a class="modal-action modal-close waves-effect waves-green btn btn-close"><i
                            class="large material-icons left ">close</i><span class="translate">Cancel</span></a>
                </div>
            </div>
        </div>
</body>

</html>